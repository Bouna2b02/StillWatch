import{_,s as c}from"./tmdbAPI.f1c79019.js";import{_ as g,z as y,s as S,o as s,c as n,t as v,q as r,a as w,F as q,v as L,n as d}from"./entry.b94904b0.js";import{L as R}from"./loading-spinner.4dbc908b.js";import"./nuxt-link.4b690bdb.js";const $={components:{Card:_,LoadingSpinnerIcon:R},props:{title:{type:String,required:!1,default:""},items:{type:Object,required:!0},loading:{type:Boolean,required:!1,default:!1}},mounted(){window.addEventListener("scroll",this.getScrollPosition)},beforeDestroy(){window.removeEventListener("scroll",this.getScrollPosition)},methods:{getScrollPosition:y(function(){this.items.page<this.items.total_pages?window.innerHeight+window.pageYOffset>=document.body.offsetHeight-600&&!this.loading&&this.loadMore():window.removeEventListener("scroll",this.getScrollPosition)},50),loadMore(){this.$emit("loadMore")}}},b={class:"listing"},k={key:0,class:"listing__head"},x={key:0,class:"listing__title"},P={class:"listing__items"},E={key:1,class:"listing__nav"};function F(e,o,t,i,u,a){const l=_,p=S("LoadingSpinnerIcon");return s(),n("div",b,[t.title?(s(),n("div",k,[t.title?(s(),n("h2",x,v(t.title),1)):r("",!0)])):r("",!0),w("div",P,[(s(!0),n(q,null,L(t.items.results,h=>(s(),d(l,{key:`card-${h.id}`,item:h},null,8,["item"]))),128))]),t.items.page<t.items.total_pages?(s(),n("div",E,[t.loading?(s(),d(p,{key:0})):r("",!0)])):r("",!0)])}const f=g($,[["render",F]]);let m="/";const M={components:{SearchResults:f},beforeRouteEnter(e,o,t){m=o.path,t()},beforeRouteUpdate(e,o,t){t(),this.getResults()},beforeRouteLeave(e,o,t){const i=document.getElementById("search");t(),i!=null&&i.value.length&&this.$search.closeSearchForm()},async asyncData({query:e,error:o,redirect:t}){try{if(e.q)return{items:await c(e.q,1)};t("/")}catch{o({message:"Page not found"})}},data(){return{loading:!1}},head(){return{title:"Search",meta:[{hid:"og:title",property:"og:title",content:"Search"},{hid:"og:url",property:"og:url",content:`${{}.FRONTEND_URL}${this.$route.path}`}],bodyAttrs:{class:"page page-search"}}},computed:{query(){return this.$route.query.q||""},title(){return this.query?`Results For: ${this.query}`:""},searchResultsShown(){var e;return(e=this.items)==null?void 0:e.results.length}},mounted(){this.$search.openSearchForm(),this.$search.setFromPage(m)},methods:{async getResults(){if(!this.query.length){this.items=null;return}const e=await c(this.query);if(!e.total_results){this.items=null;return}this.items=e},loadMore(){this.loading=!0,c(this.query,this.items.page+1).then(e=>{this.items.results=this.items.results.concat(e.results),this.items.page=e.page,this.loading=!1}).catch(()=>{this.loading=!1})}}},B={class:"main"};function O(e,o,t,i,u,a){const l=f;return s(),n("main",B,[a.searchResultsShown?(s(),d(l,{key:0,title:a.title,items:e.items,loading:u.loading,onLoadMore:a.loadMore},null,8,["title","items","loading","onLoadMore"])):r("",!0)])}const H=g(M,[["render",O]]);export{H as default};
